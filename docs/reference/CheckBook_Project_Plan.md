# CheckBook: 프로젝트 기획 & 아키텍처 설계서 (v0.9)

> **목표**: 한 번의 검색으로 주변 도서관의 **소장/대출 가능 여부**를 빠르게 확인하고, 사용자의 **독서 여정(찜/읽는 중/완독)**을 기록·리뷰할 수 있는 웹서비스.
> **타깃**: 20–30대 남녀, 책을 읽고 도서관을 이용하는 실사용자.
> **버전 범위**: MVP(8–10주) 기준. 스코프 크립 방지 위해 우선순위 구분.

---

## 1) 핵심 가치 제안 (Value Proposition)
- **검색 통합**: 도서명/저자명으로 검색 → 결과 클릭 시, 내 위치 기준 **5km 내 도서관**의 소장/대출 가능 여부를 한 화면에서 확인.
- **내 도서관 우선**: 사용자가 지정한 **내 도서관(최대 3개)**을 항상 최상단 노출.
- **독서 트래킹**: 찜/읽는 중/완독 + 별점/코멘트 + (선택) 시작·완독 날짜 캘린더 입력.
- **빠른 행동 유도**: 도서관 상세(홈페이지/전화/주소/영업시간) 바로가기.

**핵심 KPI(초기)**  
- 검색→상세 전환율 ≥ 40%  
- 상세→도서관 액션(전화/방문/링크 클릭) ≥ 20%  
- 독서 상태 업데이트 주당 사용자당 ≥ 1.5회

---

## 2) 주요 페르소나 & JTBD
- **도서관 헤비유저(직장인/대학생)**: 출퇴근/통학 동선 내 도서관 소장 여부를 **빨리** 알고 싶다.  
  → *“퇴근 전에 빌릴 수 있는지 30초 안에 판단하고 싶다.”*
- **가벼운 독서가(주말 이용)**: 가끔 책을 빌리고 기록하고 싶다.  
  → *“읽고 싶은 책을 저장하고, 나중에 근처 도서관에서 빌릴 수 있으면 좋겠다.”*

---

## 3) 범위(스코프) & 우선순위
### P0 (MVP 필수)
1. **회원**: 가입/로그인/로그아웃/탈퇴, 프로필(닉네임, 기본 위치/반경 설정).
2. **도서 검색**: 알라딘 API로 도서명/저자 검색, 결과 리스트(커버/제목/저자/출판/발행연/평점).
3. **도서 상세**: 메타 정보 + **근처 5km 도서관** 리스트(내 도서관 우선).  
   - 각 도서관: 소장/대출가능/불명, 홈페이지/전화/주소/지도 보기.
4. **내 도서관 관리(최대 3개)**: 시도/시군구 필터로 검색→저장/삭제/정렬.
5. **독서 상태**: 찜/읽는 중/완독 전환, 별점/코멘트, 시작/완독 날짜(캘린더).

### P1 (가까운 확장)
- 반경 설정(1~20km), 즐겨찾기 도서관 가중 정렬, 서랍형 비교 보기.
- 소장 불명 도서관에 “전화 문의”/“소장여부 신고” 플로우.
- 리뷰 모더레이션(신고/숨김), 소셜 공유(링크).

### P2 (차후)
- 알림(대출 가능 전환 감지), 읽기 목표/리포트, 추천(취향/지역).

---

## 4) 정보 구조 & 핵심 화면
- **홈(검색창 + 최근 검색/최근 본 책/내 도서관 요약)**
- **검색 결과 리스트**: 무한 스크롤, 정렬(관련도/발행연/평점), 필터(국내/해외).
- **도서 상세**: 상단 책 정보, 중단 도서관 카드(내 도서관 > 가까운 순), 하단 리뷰/상태 버튼.  
- **내 도서관 관리**: 지역 선택 → 리스트 → 저장(최대 3개).  
- **마이페이지**: 내 리뷰/상태 타임라인(찜/읽는 중/완독 탭).

---

## 5) 사용자 플로우 (요약)
**검색→상세→도서관 결정**
```
검색어 입력 → 결과 리스트 → 책 선택 →
[상세] 도서관 섹션: (내 도서관 상단) + (근처 5km) →
‘대출 가능’ 표시 시 바로 전화/방문 → 상태 업데이트(읽는 중/완독)
```
**내 도서관 등록**
```
마이페이지 → 내 도서관 → 지역 필터 검색 → 선택(최대 3) → 저장
```

---

## 6) 비즈니스 규칙
- **반경 기본값 5km**, 사용자 설정 값은 프로필에 저장. 위치 권한 미동의 시 **내 도서관**만 노출.
- **내 도서관 정렬**: 사용자가 지정한 순서 > 가까운 순.
- **대출 가능 여부**  
  - API 제공 도서관: 실시간/준실시간 값 사용.  
  - 비제공 도서관: 소장 여부만, 또는 ‘불명’ 처리(전화 문의 유도).
- **중복 도서관 통합**: 동일 도서관의 서로 다른 소스(API/크롤링) 결과는 **기관코드/주소+전화**로 정합.
- **리뷰 정책**: 욕설/개인정보 자동 필터링, 신고 3회 이상 숨김.

---

## 7) 기술 아키텍처 (제안)
### 스택
- **프론트**: React(Next.js) or Vue(Nuxt), TypeScript, Tailwind, TanStack Query.
- **백엔드**: **Spring Boot(Java)** + JPA, Gradle. (팀 선호도/기존 경험 고려)  
- **DB**: PostgreSQL(+ PostGIS), **Redis**(캐시, 세션), S3(이미지/정적 리소스).
- **지도/지오코딩**: 카카오/네이버 지도 API.
- **CI/CD**: GitHub Actions → Docker → K8s(or ECS)/RDS.
- **관측성**: ELK or OpenSearch, Prometheus/Grafana, Sentry.

### 통합 아키텍처(요약 다이어그램)
```
[Web/App] ──HTTPS──> [API Gateway] ──> [Spring Boot]
                                   ├─(Aladin API) 도서 검색
                                   ├─(공공도서관 정보나루 API/KOLIS-NET*) 소장/대출여부
                                   ├─ Redis 캐시
                                   ├─ Postgres(+PostGIS)
                                   └─ S3(이미지/리뷰 첨부)
* 비공식/크롤링은 별도 어댑터 서비스로 분리, 재시도/백오프/파싱 변경 대응
```

### 성능 전략
- **검색 결과 캐시**(키: 질의어+페이지) 10~30분 TTL.
- **도서 상세의 도서관 가용성**: 1) 내 도서관 우선 조회(병렬), 2) 반경 내 도서관은 배치/온디맨드 혼합 캐시.  
- **지오쿼리**: PostGIS(Haversine) 또는 DB-side ST_DWithin.
- **레이트 리밋/서킷 브레이커**: 외부 API 보호(Resilience4j).

---

## 8) 외부 연동 설계 (초안)
- **알라딘 Open API**: 도서명/저자 검색, ISBN/커버/설명 수집. 응답 스키마 표준화해서 내부 DTO로 변환.
- **도서관 가용성**  
  1) **공공도서관 정보나루 API** 우선 사용(가능 시).  
  2) **KOLIS-NET/개별 도서관** 페이지는 *크롤링 어댑터*로 분리(법적/기술적 변경 리스크를 격리).  
- **지도**: 좌표 변환/정규화, 주소-좌표 역/정방향 지오코딩.

> **법/정책 유의**: 크롤링 시 서비스 약관 준수, robots.txt 확인, 과도한 요청 금지. 개인정보·저작권 정책 반영.

---

## 9) 데이터 모델 (요약 ERD)
```
User(id, email, password_hash, nickname, home_lat, home_lng, radius_km, created_at, ...)
Library(id, official_code?, name, phone, homepage, address, lat, lng, province, city, ...)
UserLibrary(user_id*, library_id*, order_index)      // 최대 3개
Book(id, isbn13, title, author, publisher, pub_year, cover_url, meta_json, ...)
BookAvailability(id, library_id*, book_id*, status, last_checked_at, source, raw_payload)
   // status: AVAILABLE | UNAVAILABLE | UNKNOWN
UserBookState(id, user_id*, book_id*, state, rating, comment, start_date, end_date, updated_at)
   // state: WISHLIST | READING | READ
Review(id, user_id*, book_id*, rating, comment, created_at, is_hidden)
SearchLog(id, user_id?, query, filters_json, created_at)
```

---

## 10) API (예시)
- `GET /api/books/search?q=도서명|저자&page=` – 알라딘 API 래핑 + 캐시
- `GET /api/books/{bookId}` – 상세(메타+가용성 요약)
- `GET /api/books/{bookId}/availability?lat=&lng=&radiusKm=` – 반경 내 도서관 가용성
- `GET /api/libraries?province=&city=&q=` – 도서관 검색
- `POST /api/me/libraries` / `DELETE /api/me/libraries/{id}` – 내 도서관 관리
- `POST /api/me/books/{bookId}/state` – 상태 전환(찜/읽는 중/완독), 별점/코멘트 포함
- `GET /api/me/timeline` – 내 활동 피드
- 인증: `POST /api/auth/signup|signin|signout` (JWT + Refresh), `DELETE /api/me` (탈퇴)

---

## 11) UX 원칙 & 접근성
- **리스트 가독성**: 썸네일 좌, 텍스트 우, 2줄 트렁케이션, 주요 액션은 우측 고정 버튼.
- **상세의 우선순위**: 대출 가능 여부 신호(초록/회색 아이콘), 내 도서관 상단 그리드 1~3개.
- **오프라인/느린망**: 로딩 스켈레톤, 재시도 버튼, 마지막 캐시 표시.
- **접근성**: 키보드 포커스, ARIA 라벨, 색 대비 4.5:1, 모션 최소화 옵션.
- **다국어(차후)**: ko → en 구조 확장.

---

## 12) 보안/개인정보
- 비밀번호 Argon2/BCrypt, JWT + Refresh Token(회전/블랙리스트).
- PII 최소 수집(좌표는 반경 질의 후 **즉시 폐기** 또는 토큰화), 위치 권한 옵트인.
- 감사 로그(관리자/크롤링 작업), 레이트리밋(IP+계정).

---

## 13) 관측/분석 & 성공 지표
- 프론트: 페이지 전환/클릭(전화/링크/지도), 상태 변경 이벤트.
- 백엔드: 외부 API 실패율/지연, 캐시 적중률, 가용성 새로고침 시간.
- KPI: 7일 잔존/월간 활성, 검색→상세→행동 퍼널, 재방문율.

---

## 14) 프로젝트 일정(예시, 9주)
1. 주1–2: 요구정의/와이어프레임/스키마/POC(알라딘+지도).  
2. 주3–4: 인증/검색/상세(내 도서관 3개), 기본 가용성 API 통합.  
3. 주5–6: 독서 상태/리뷰, 캐시·지오쿼리 최적화, QA 1차.  
4. 주7–8: 크로스브라우저/접근성, 로깅/모니터링, 리허설.  
5. 주9: 베타 릴리스 & 관측 지표 점검, 버그픽스.

---

## 15) 리스크 & 대응
- **외부 API 불안정/제한**: 캐시·폴백(UNKNOWN), 큐 기반 재시도, 소스 우선순위.  
- **크롤링 변경/차단**: 어댑터 분리/피처플래그, 요청량 제어, 법무 검토.  
- **데이터 정합성(중복 도서관)**: 표준 키(공식코드/주소+전화), 주기적 정규화 잡.  
- **위치 개인정보**: 옵트인/가명화/최소화, 내부 접근 통제.

---

## 16) 성공 기준 (MVP 출고 체크리스트)
- [ ] 반경 5km 내 가용성 표시(내 도서관 최상단)  
- [ ] 상태 전환(찜/읽는 중/완독)과 리뷰 입력  
- [ ] 검색 성능 p95 < 800ms(캐시 적중 시)  
- [ ] 외부 연동 장애 시에도 코어 플로우(검색→상세) 동작  
- [ ] 기본 접근성 체크 통과(ARIA/대비/키보드)

---

### 부록) UI 컴포넌트 제안
- 검색바(모바일 상단 고정) / 리스트카드(커버·제목·저자·태그)  
- 도서관 카드(상태 아이콘/거리/액션 버튼) / 상태 토글(찜/읽는 중/완독)  
- 캘린더 모달(시작/완독 날짜) / 별점 + 140자 코멘트 필드

> 작성: PM/시니어 개발자 관점. 문의/수정 요청 시 버전업 예정.
